<!doctype html>
<html lang="en">
	<head>
        
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel='shortcut icon' type='image/x-icon' href='https://memoex.github.io/favicon.ico' />




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.0.1/tocbot.css">


<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />


<link rel="stylesheet" href="https://memoex.github.io/css/bootstrap-docs.min.css">


<link rel="stylesheet" href="https://memoex.github.io/css/material.min.css">


<link rel="stylesheet" href="https://memoex.github.io/css/fancybox.min.css">

    </head>
    <body>
        <header class="z-depth-2 navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar">
    <a class="navbar-brand mr-0 mr-md-2" href="https://memoex.github.io//" aria-label="Mr.Blue">
        <span>Mr.Blue</span>
    </a>
    <div class="navbar-nav-scroll">
        <ul class="navbar-nav bd-navbar-nav flex-row">
        
            
                
            
            
            <li class="px-1 nav-item active">
                <a class="nav-link" href="https://memoex.github.io/note/"><span>Note</span></a>
            </li>
        
            
                
            
            
            <li class="px-1 nav-item ">
                <a class="nav-link" href="https://memoex.github.io/project/"><span>Project</span></a>
            </li>
        
            
                
            
            
            <li class="px-1 nav-item ">
                <a class="nav-link" href="https://memoex.github.io/about/"><span>About</span></a>
            </li>
        
        </ul>
    </div>
</header>


        <div class="container-fluid">
        <div class="row flex-xl-nowrap">
            <div class="col-12 col-md-3 col-xl-2 px-0 mx-0">
                
                    




<div class="bd-sidebar px-3">
    <form class="bd-search d-flex align-items-center">
      <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"><input type="search" class="form-control ds-input" id="search-input" placeholder="Not work yet..." autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="ds-dataset-1"></div></span></span>
      <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#bd-docs-nav" aria-controls="bd-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg>
    </button>
    </form>


    <nav id="bd-docs-nav" class="collapse bd-links">
        
            
        
            
        
            
        
            
            <div class="bd-toc-item active">
            
    
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/tech/">
                    Tech
                </a>
                    
    
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/tech/lang/">
                    Languages
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/python/">
                Python
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/go/">
                Go
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/julia/">
                Julia
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/css/">
                CSS
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/js/">
                JavaScript
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/matlab/">
                Matlab
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/lang/shell/">
                Shell
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/tech/ml/">
                    Machine Learning
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/ml/">
                Machine Learning
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/image/">
                Image
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/datasets/">
                Datasets
                </a>
            </li>
            
            <li class="active" >
                <a href="https://memoex.github.io/note/tech/ml/augmentation/">
                Data Augmentation
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/metrics/">
                Metrics
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/loss/">
                Loss Function
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/optimization/">
                Optimization
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/boosting/">
                Boosting
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/ml/forward/">
                Forward Learning
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/tech/framework/">
                    Framework
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/framework/tensorflow/">
                Tensorflow
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/framework/keras/">
                Keras
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/framework/bootstrap/">
                Bootstrap
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/framework/hugo/">
                Hugo
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/write/">
                Write
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/color/">
                Color
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/adobe/">
                Adobe
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/docker/">
                Docker
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/vim/">
                Vim
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/tech/git/">
                Git
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/math/">
                    Math
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/math/math/">
                Math
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/math/calculus/">
                Calculus
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/math/la/">
                Linear Algebra
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/course/">
                    Course
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/course/cs231n/">
                CS231n
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/course/brain/">
                MCB80x
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/course/hinton/">
                Hinton Course
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/life/">
                    书，路
                </a>
                    
    
        
            <div class="pl-2 bd-toc-item active">
                <a class="bd-toc-link" href="https://memoex.github.io/note/life/museum/">
                    博物之旅
                </a>
                    
    
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/museum/build/">
                北京古代建筑博物馆
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
        
        <ul class="pr-2 nav bd-sidenav">
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/pubg/">
                绝地求生
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/csgo/">
                CSGO
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/alcohol/">
                酒
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/road/">
                行走
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/culture/">
                文化
                </a>
            </li>
            
            <li class="" >
                <a href="https://memoex.github.io/note/life/wutai/">
                行于五台
                </a>
            </li>
            
        </ul>
        
    
            </div>
        
        
    
            </div>
            
        
            
        
    </nav>

    
</div>

                
            </div>

            <div class="d-none d-xl-block col-xl-2 bd-toc">
            </div>

            <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5" role="main">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col">
                            <h1 class="bd-title">Data Augmentation</h1>
                            <div class="mb-5 bd-info">
    <div>
        <i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>
        <time class="font-weight-bold grey-text text-darken-3">Mar 8, 2018</time>
        
            <i class="ml-2 far fa-edit fa-fw" aria-hidden="true"></i>
            <time class="font-weight-bold grey-text text-darken-3">Apr 15, 2018</time>
        
    
    </div>
</div>

                            <div class="bd-content">
                                <p>Data augmentation is the process of increasing the size of a dataset by transforming it
in ways that a neural network is unlikely to learn by itself.</p>

<p>This article will introduce:</p>

<ul>
<li>Common data augmentation methods.</li>
<li>Image augmentation with <code>imgaug</code>.</li>
<li>Popular tools for data augmentation.</li>
</ul>

<p></p>

<h2 id="methods">Methods</h2>

<p>In this section, I will introduce these augmentation methods:</p>

<ol>
<li>cropping</li>
<li>shifting</li>
<li>rotating</li>
<li>flipping</li>
<li>shearing</li>
<li>color jittering

<ol>
<li>brigheness</li>
<li>contrast</li>
<li>fancy PCA</li>
</ol></li>
<li>salt and pepper</li>
</ol>

<p>The original images get from cifar-10 is like this:</p>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/2w0WeeM.png" data-fancybox="gallery" data-caption="original images">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/2w0WeeM.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>original images</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">from keras.datasets import cifar10

import matplotlib.pyplot as plt
import numpy as np
from numpy import linalg as la
from sklearn.decomposition import PCA

from imgaug import augmenters as iaa
import imgaug as ia

%matplotlib inline
(X_train, y_train), (X_test, y_test) = cifar10.load_data()
X_train = X_train.astype('float32')
y_train = y_train.astype('float32')

def show9(imgs):
    ''' Create a grid of 3x3 images
    '''
    if imgs.max() &gt; 1:
        imgs = imgs / 255.

    for i in range(0, 9):
        plt.subplot(330 + 1 + i)
        plt.imshow(imgs[i], cmap=plt.get_cmap())
    plt.show()

imgs = X_train[0:9]
show9(imgs)
</code></pre>

<h3 id="cropping">cropping</h3>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/bvkU57j.png" data-fancybox="gallery" data-caption="images with cropping">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/bvkU57j.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with cropping</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py"># simplify code
def show_img_augs(imgs, imgaug_seq):
    ia.seed(1)
    imgs_aug = seq.augment_images(imgs)
    show9(imgs_aug)

seq = iaa.Sequential([
    iaa.Crop(percent = (0, 0.3))
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="shifting">shifting</h3>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/sFLIDvK.png" data-fancybox="gallery" data-caption="images with shifting">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/sFLIDvK.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with shifting</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Affine(translate_percent={'x':(-0.1,0.1), 'y':(-0.1,0.1)})
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="rotating">rotating</h3>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/f8rLLZn.png" data-fancybox="gallery" data-caption="images with rotating">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/f8rLLZn.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with rotating</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Affine(rotate=(-25, 25))
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="flipping">flipping</h3>

<p>Also called as reflection or mirroring.</p>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/UoyJQ3D.png" data-fancybox="gallery" data-caption="images with horizontal flipping">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/UoyJQ3D.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with horizontal flipping</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Fliplr(0.5)
])
show_img_augs(imgs, seq)
</code></pre>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/bfH3ttq.png" data-fancybox="gallery" data-caption="images with vertical flipping">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/bfH3ttq.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with vertical flipping</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Flipud(0.5)
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="shearing">shearing</h3>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/rZEzakR.png" data-fancybox="gallery" data-caption="images with shearing">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/rZEzakR.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with shearing</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Affine(shear=(-20, 20))
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="color-jitter">color jitter</h3>

<p>For color jitter, the knowledge of <a href="/note/color/#color-space">color space</a> may help.</p>

<h4 id="brightness">brightness</h4>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/9gO6BJa.png" data-fancybox="gallery" data-caption="change the brightness of images">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/9gO6BJa.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>change the brightness of images</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.Multiply((0.1, 1.5))
])
show_img_augs(imgs, seq)
</code></pre>

<h4 id="contrast">contrast</h4>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/Ef9no0K.png" data-fancybox="gallery" data-caption="change the contrast of images">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/Ef9no0K.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>change the contrast of images</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.ContrastNormalization((0.75, 1.5))
])
show_img_augs(imgs, seq)
</code></pre>

<h4 id="fancy-pca">fancy PCA</h4>

<p>Fancy PCA or PCA Color Augmentation is a type of data augmentation technique
first mentioned in Alex&rsquo;s paper <em>ImageNet Classification with Deep Convolutional Neural Networks</em>.</p>

<p>The original words in the paper:</p>

<blockquote>
<p>We perform PCA on the set of RGB pixel values throughout the ImageNet training set.</p>

<p><strong>To each training image, we add multiples of the found principal components,
with magnitudes proportional to the corresponding eigenvalues times a random variable
drawn from a Gaussian with mean zero and standard deviation 0.1.</strong></p>

<p>Therefore <strong>to each RGB image pixel \(I_{xy} = [I_{xy}^R,I_{xy}^G,I_{xy}^B]^T\)
we add the following quantity:</strong>
$$
[p_1,p_2,p_3][\alpha_1 \lambda_1 , \alpha_2 \lambda_2 , \alpha_3 \lambda_3]^T
$$
<strong>where \(p_i\) and \(\lambda_i\) are
\(i\)th eigenvector and eigenvalue of the \(3 \times 3\) covariance matrix of RGB pixel vales,
respectively, and \(\alpha_i\) is the aforementioned random variable.</strong></p>

<p>Each \(\alpha_i\) is drawn only once for all the pixels of a particular training image
until that image is used for training again,
at which point it is re-drawn. This scheme aproximately captures an important property of natural images,
namely, that object identity is invariant to changes in the intensity and color of illuminiation.
This scheme reduces the top-1 error rate by over 1%.</p>
</blockquote>

<p>So the whole steps of fancy PCA is:</p>

<ol>
<li>Resize data&rsquo;s shape into <code>(n * width * height, 3)</code></li>
<li>Standardize data into unit scale ( mean=0, variance=1 )</li>
<li>Compute the eigen values and eigen vectors.

<ul>
<li>Decomposition of covariance matrix</li>
<li>Decomposition of correlation matrix</li>
<li>Use skit-learn&rsquo;s tool</li>
</ul></li>
<li>Image augmentation</li>
</ol>

<p>Code for this:</p>

<pre><code class="language-py"># 1. Resize
res = np.array([]).reshape([0,3])
for img in imgs:
    img = img / 255.
    arr = img.reshape(img.shape[0]*img.shape[1], 3)
    res = np.vstack([res, arr])

# 2. Standardize
mean = res.mean(axis=0)
std = res.std(axis=0)
res_std = (res - mean) / std

# 3. Eigendecomposition
pca = PCA()
rgb_pca = pca.fit(res_std)
eigen_values = rgb_pca.explained_variance_
eigen_vectors = rgb_pca.components_.T
print 'Eigen Values \n%s' % eigen_values
print 'Eigen Vectors \n%s' % eigen_vectors

# 4. Image augmentation
def data_aug(img, eig_vals, eig_vecs):

    if len(eig_vals.shape) == 1:
        eig_vals = eig_vals[np.newaxis, :]

    mu = 0
    sigma = 0.1

    # 3 x 1 scaled eigenvalue matrix
    w = np.random.normal(mu, sigma, (1,3)) * eig_vals
    noise = eig_vecs.dot(w.T).reshape([1,1,3])

    # perturbe the image
    img_aug = img + noise

    return img_aug

def data_augs(imgs, eig_vals, eig_vecs):

    img_augs = imgs.copy()

    for i in xrange(img_augs.shape[0]):
        img_augs[i] = data_aug(img_augs[i], eig_vals, eig_vecs)

    return img_augs

img_augs = data_augs(imgs/255., eigen_values, eigen_vectors)
show9(img_augs)
</code></pre>

<p>The entire code in notebook is <a href="https://nbviewer.jupyter.org/github/blue-fatty/notebooks/blob/master/scripts/keras-image-augmentation.ipynb">here</a>
or you can find it in my <a href="https://github.com/blue-fatty/notebooks">notebooks repo</a>.</p>

<p>See also: <a href="https://deshanadesai.github.io/notes/Fancy-PCA-with-Scikit-Image">Fancy PCA (Data Augmentation) with Scikit-Image</a></p>

<h3 id="salt-and-pepper">salt and pepper</h3>

<p>Add salt (white points) and pepper (black points) to images.</p>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/HJ2VhEn.png" data-fancybox="gallery" data-caption="add salt and pepper to images">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/HJ2VhEn.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>add salt and pepper to images</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.SaltAndPepper(p=(0, 0.1))
])
show_img_augs(imgs, seq)
</code></pre>

<h3 id="distortion">distortion</h3>

<div class="col-12 col-xl-9 col-lg-12 container-fluid mx-0 px-0 mx-auto">
    <a class="d-block mx-auto" href="https://i.imgur.com/874Tjkp.png" data-fancybox="gallery" data-caption="images with distortion">
        <img class="mw-100 mt-2 px-0 rounded d-block mx-auto" src="https://i.imgur.com/874Tjkp.png" />
    </a>

    
    <p class='mb-5 mt-2 text-center font-weight-bold'>images with distortion</p>
    
</div>


<p>Code for this:</p>

<pre><code class="language-py">seq = iaa.Sequential([
    iaa.PiecewiseAffine(scale=(0.01, 0.07))
])
show_img_augs(imgs, seq)
</code></pre>

<hr />

<p>You can read <a href="https://github.com/aleju/imgaug">REDME.md of imgaug</a> for more augmentation methods.</p>

<h2 id="tools">Tools</h2>

<h3 id="imgaug">imgaug</h3>

<blockquote>
<p><code>imgaug</code> is a library for image augmentation in machine learning experiments. It supports a wide range of augmentation techniques, allows to easily combine these, has a simple yet powerful stochastic interface, can augment images and keypoints/landmarks on these and offers augmentation in background processes for improved performance.
<br/></p>

<p><a href="https://github.com/aleju/imgaug">Github</a></p>
</blockquote>

<h4 id="a-standard-use-case">A standard use case</h4>

<p>The following example shows a standard use case. An augmentation sequence (crop + horizontal flips + gaussian blur) is defined once at the start of the script. Then many batches are loaded and augmented before being used for training.</p>

<pre><code class="language-py">from imgaug import augmenters as iaa

seq = iaa.Sequential([
    iaa.Crop(px=(0, 16)), # crop images from each side by 0 to 16px (randomly chosen)
    iaa.Fliplr(0.5), # horizontally flip 50% of the images
    iaa.GaussianBlur(sigma=(0, 3.0)) # blur images with a sigma of 0 to 3.0
])

for batch_idx in range(1000):
    # 'images' should be either a 4D numpy array of shape (N, height, width, channels)
    # or a list of 3D numpy arrays, each having shape (height, width, channels).
    # Grayscale images must have shape (height, width, 1) each.
    # All images must have numpy's dtype uint8. Values are expected to be in
    # range 0-255.
    images = load_batch(batch_idx)
    images_aug = seq.augment_images(images)
    train_on_images(images_aug)
</code></pre>

<h4 id="links">Links</h4>

<ul>
<li><a href="https://github.com/aleju/imgaug">Github homepage of imgaug</a></li>
<li><a href="http://imgaug.readthedocs.io/en/latest/source/examples_basics.html">Brief and complex Examples</a></li>
<li><a href="http://imgaug.readthedocs.io/en/latest/source/augmenters.html">Quick reference</a></li>
</ul>

<h3 id="imagedatagenerator-in-keras">ImageDataGenerator in Keras</h3>

<ul>
<li><a href="https://keras.io/preprocessing/image/">Keras - Image Preprocessing</a></li>
</ul>

<p>Data from memory:</p>

<pre><code class="language-py">(x_train, y_train), (x_test, y_test) = cifar10.load_data()
y_train = np_utils.to_categorical(y_train, num_classes)
y_test = np_utils.to_categorical(y_test, num_classes)

datagen = ImageDataGenerator(
    rotation_range=20,
    width_shift_range=0.2,
    height_shift_range=0.2,
    horizontal_flip=True)

# compute quantities required for featurewise normalization
# (std, mean, and principal components if ZCA whitening is applied)
datagen.fit(x_train)

# One way: Fits the model on batches with real-time data augmentation:
model.fit_generator(datagen.flow(x_train, y_train, batch_size=32),
                    steps_per_epoch=len(x_train) / 32, epochs=epochs)

# Another way: &quot;manual&quot; example
for e in range(epochs):
    print('Epoch', e)
    batches = 0
    for x_batch, y_batch in datagen.flow(x_train, y_train, batch_size=32):
        model.fit(x_batch, y_batch)
        batches += 1
        if batches &gt;= len(x_train) / 32:
            # we need to break the loop by hand because
            # the generator loops indefinitely
            break
</code></pre>

<p>When training on cifar-10 dataset, rotation has little effects.
Width shift, height shift and horizontal flip are used and usually can improve accuracy about 10%.
By using these data augmentation methods, we can avoid overfitting very efficiently.</p>

<hr />

<p>Data from disk:</p>

<pre><code class="language-py">train_datagen = ImageDataGenerator(
        rescale=1./255,
        shear_range=0.2,
        zoom_range=0.2,
        horizontal_flip=True)

test_datagen = ImageDataGenerator(rescale=1./255)

train_generator = train_datagen.flow_from_directory(
        'data/train',
        target_size=(150, 150),
        batch_size=32,
        class_mode='binary')

validation_generator = test_datagen.flow_from_directory(
        'data/validation',
        target_size=(150, 150),
        batch_size=32,
        class_mode='binary')

model.fit_generator(
        train_generator,
        steps_per_epoch=2000,
        epochs=50,
        validation_data=validation_generator,
        validation_steps=800)
</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                    <hr class="my-5">

<div class="col" id="disqus_thread"></div>
<script>




var disqus_config = function () {
    this.page.url = "https://memoex.github.io/note/tech/ml/augmentation/";  
    this.page.identifier = "/note/tech/ml/augmentation/"; 
};

(function() { 
var d = document, s = d.createElement('script');
    s.src = 'https://silverhugh.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


                
                


            </main>
        </div>
    </div>

        



        


<script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js" integrity="sha256-pS96pU17yq+gVu4KBQJi38VpSuKN7otMrDQprzf/DWY=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js" integrity="sha256-meF2HJJ2Tcruwz3z4XcxYDRMxKprjdruBHc3InmixCQ=" crossorigin="anonymous"></script>
<script>


function tooltip(obj, text){
    obj.tooltip('dispose')
    obj.tooltip({
        title: text,
        boundary: 'viewport',
        trigger: 'hover'
    })
    return obj
}

 
$('pre').each(function(i, l){

    var btn = $('\x3cbutton type=\x22button\x22 class=\x22btn btn-light btn-copycode\x22 data-toggle=\x22tooltip\x22\x3e\n    \x3ci class=\x22fa fa-paste\x22\x3e\x3c\/i\x3e\n\x3c\/button\x3e\n').hide()
    l.prepend(btn[0])

     
    $(l).hover(function(){
        btn.show()
        tooltip(btn, 'Copy to clipboard')
    }, function(){
        btn.fadeOut(200)
    })
})


 
var clipboard = new ClipboardJS('.btn-copycode', {
    target: function(trigger) {
        return trigger.nextElementSibling
    }
})

 
clipboard.on('success', function(e){
    e.clearSelection()
    tooltip($(e.trigger), 'Copied').tooltip('show')
})
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/matlab.min.js" integrity="sha256-HHSLUGB2us1mDkYuEDaK0mDZ6T/ugh5qqtGynscVWHU=" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.2.1/tocbot.min.js"></script>
<script>
$(function(){
    tocbot.init({
        
        tocSelector: '.bd-toc',
        
        contentSelector: 'main',
        
        headingSelector: 'h2, h3, h4',
        listClass: 'toc-list',
        listItemClass: 'toc-entry',
        linkClass: 'font-weight-normal',
        activeLinkClass: 'active',
        collapseDepth: 6,
    });
});
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script>

    </body>
</html>
